---
title: "Gov 50 Final Project"
author: "Paula Barberi"
description: "Homelessness and Shelter Bed Availability in MA"
output:
  distill::distill_article:
    self_contained: false
---



## Final Project Milestone 1: Project Thoughts

I am interested in exploring data related to emergency homeless shelters in Boston, MA or a city in my home state of Michigan. More specifically, I'd like to examine the relationship between demographic factors like gender and age with utilization of the shelter and how that compares with the published demographic data of those experiencing homelessness in the area. I'd heard that the numbers of young adults experiencing homelessness in my hometown is increasing, but at the same time, there are no young adult homeless shelters that I know of. In Cambridge/Boston, there are only a few shelters that specifically serve young adults. I may need to shift my questions as I figure out what data is publicly accessible, but at the very least I know the topics I would like to research more. 

## Final Project Milestone 2: Project Proposal

It has been reported repeatedly that America's homelessness and housing crises are on the rise, but how have homeless shelters changed as a result? Has shelter bed availability risen as well? In this study, I plan to examine how reported shelter bed availability in the United States has changed (or not) as the prevalence of homelessness has changed between the years of 2007 and 2022. Homelessness is incredibly stigmatized in this country and research has shown how discrimination against unhoused people has limited their political, econonomic, and social rights. A National Homelessness Law Center report found that between 2006 and 2019, city-wide bans on camping increased by more than 90%, and this is just one example of how homelessness is criminalized. Considering the abundance of anti-homelessness attitudes and legislation, I hypothesize that as the prevalence of homelessness has grown, especially in the past decade, shelter bed availability has not increased to the same extent. 

I still need to select a particular CoC type for my unit of analysis. Through the Department of Housing and Urban Development (HUD), different geographic areas in the United States are identified as a particular CoC (a Continuum of Care), which is a regional group that coordinates housing and services funding for unhoused families and individuals as prescribed by the HUD CoC policies. There are different CoC types, for example, "Largely Rural", "Major City", "Largely Suburban" etc. The explanatory variable of interest is the proportion of the population that is considered to be homeless and the outcome variable is the number of available shelter beds for that same year. This data will come from a merging of two of HUD's datasets focusing on Point in Time and Housing in Time counts for CoCs between the years of 2007 and 2022. As mentioned earlier, the CoC type is determined and defined by HUD. If I observe that the number of available shelter beds does not increase (remains similar or decreases) when the prevalence of homelessness increases, this would provide support for my hypothesis. If I observe that the number of available shelter beds increases as the prevalence of homelessness increases, this would provide support against my hypothesis. 

## Final Project Milestone 3: Data Visualization
```{r, background}
#load PIT data
library(readxl)
unhoused <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx")
library(tidyverse)
library(ggplot2)
```



```{r, datavisualization}
#rename variable
unhoused1 <- unhoused |>
  mutate(coc_category = `CoC Category`,
         overall_homeless_2022 = `Overall Homeless, 2022`,
         es_homeless_2022 = `Sheltered ES Homeless, 2022`,
         prop_es_overall_homeless_2022 = `Sheltered ES Homeless, 2022`/`Overall Homeless, 2022`)

#find unique CoC categories
unique(unhoused1$coc_category)

#group data
unhoused2 <- unhoused1 |>
  filter(!is.na(coc_category)) |>
  group_by(coc_category) |>
  summarize(avg_prop_es_overall = mean(prop_es_overall_homeless_2022, na.rm = TRUE)) 

#wrangle data
unhoused2_visual <- unhoused2 |>
  ggplot(mapping = aes(x = coc_category, y = avg_prop_es_overall, fill=coc_category)) +
  geom_col() +
  scale_fill_discrete() +
  ylim(0,1) +
  theme(axis.text.x = element_text(size = 7)) +
  labs(x = "HUD CoC Category",
       y = "Avg. Proportion of Unhoused in ES",
       title = "Average Proportion of Unhoused Folks in U.S.Emergency Shelters by CoC in 2022",
       caption = "Data from HUD 2022 Point in Time Counts")
unhoused2_visual
```

## Final Project Milestone 4: Data Visualization
```{r, data-prep}
library(tidyverse)
library(ggplot2)
library("readxl")
library(RColorBrewer)

#create dataframe for PIT Counts dataset
PIT_count <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 18)

#create dataframe for HIC Counts dataset
HIC_count <- read_excel("~/Downloads/2007-2022-HIC-Counts-by-CoC.xlsx", sheet = 17)

#create merged dataframe for PIT and HIC datasets by matching CoC


```

```{r, unsheltered-trend}
#mutate variable names (remove spaces)
PIT_count <- PIT_count |>
  mutate(year = Year,
         coc_number = `CoC Number`,
         overall_homeless = `Overall Homeless`,
         sheltered_homeless = `Sheltered Homeless`,
         unsheltered_homeless = `Unsheltered Homeless`,
         sheltered_es_homeless = `Sheltered ES Homeless`,
         sheltered_th_homeless = `Sheltered TH Homeless`,
         `Sheltered SH Homeless` = `Sheltered SH Homeless`,
         prop_sheltered_homeless = `Sheltered Homeless`/`Overall Homeless`,
         prop_unsheltered_homeless = `Unsheltered Homeless`/`Overall Homeless`)

#visualize over unsheltered trend over time
PIT_count_over_time <- PIT_count |>
  group_by(year) |>
  summarize(state_sheltered_prop = sum(sheltered_homeless)/sum(overall_homeless)*100,
            state_unsheltered_prop = sum(unsheltered_homeless)/sum(overall_homeless)*100)
PIT_count_over_time_visual <-ggplot(data = PIT_count_over_time,
       mapping = aes(x = factor(year),
                     y = state_unsheltered_prop)) +
  geom_col(stat="identity", fill="steelblue4") +
  scale_x_discrete(breaks = seq(2006,2023, 1)) +
  theme(panel.background = element_rect(fill = 'linen'),
        panel.grid.major = element_line(color = 'linen'),
        plot.title = element_text(face="bold")) + 
  labs(
    x = "Year",
    y = "Percent of Unhoused that are Unsheltered (%)",
    title = "Percent of Unhoused Folks that are Unsheltered in Massachusetts",
    subtitle = "Among MA HUD Continuums of Care from 2007-2022",
    source = "HUD Housing Inventory Count"
  )
PIT_count_over_time_visual
```
```{r, boston_bed_type_trend}
#mutate variables to remove spaces
HIC_count <- HIC_count |>
  mutate(year = Year,
         coc_number = `CoC Number`,
         total_yr_beds = `Total Year-Round Beds (ES,TH)`,
         total_yr_es_beds = `Total Year-Round Beds (ES)`)

#subset for Boston CoC
HIC_boston_yr <- HIC_count |>
  filter(coc_number == "MA-500")

#visualize Boston CoC year-round beds
HIC_boston_yr_visual <- ggplot(data = HIC_boston_yr,
       mapping = aes(x = factor(year),
                     y = total_yr_beds)) +
  geom_col(fill="steelblue4") +
  scale_x_discrete(breaks = seq(2006,2023, 1)) 
HIC_boston_yr_visual 
```


```{r, PIT_background}
library(tidyverse)
library("readxl")
#created df for each year of PIT Counts by CoC
unhoused2022 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 1)
unhoused2021 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 2)
unhoused2020 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 3)
unhoused2019 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 4)
unhoused2018 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 5)
unhoused2017 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 6)
unhoused2016 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 7)
unhoused2015 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 8)
unhoused2014 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 9)
unhoused2013 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 10)
unhoused2012 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 11)
unhoused2011 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 12)
unhoused2010 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 13)
unhoused2009 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 14)
unhoused2008 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 15)
unhoused2007 <- read_excel("~/Downloads/2007-2022-PIT-Counts-by-CoC.xlsx", sheet = 16)
#create list for 2007-2022 df
unhoused2007_2022 <- list(unhoused2022, unhoused2021, unhoused2020, unhoused2019, unhoused2018, unhoused2017, unhoused2016, unhoused2015, unhoused2014, unhoused2013, unhoused2012, unhoused2011, unhoused2010, unhoused2009, unhoused2008, unhoused2007)
```

```{r, PIT_merged_df}
#drop unnecessary columns from 2007-2022 PIT list 
shortened_unhoused <- lapply(unhoused2007_2022, function(dataset) dataset[, 1:3, drop = FALSE])

#create merged dataset for 2022-2007 and drop "duplicate" NA columns
main_unhoused_long <- shortened_unhoused |>
  reduce(inner_join, by = c("CoC Number"))
main_unhoused <- main_unhoused_long |>
  filter(`CoC Number` != "NA")

#code for checking duplicated values


```

```{r, PIT_visualization}
main_unhoused_city <- main_unhoused |>
  filter(`CoC Category` == "Major City CoC") |>
  summarize(avg_unhoused_2021 = mean(`Overall Homeless, 2021`),
            avg_unhoused_2020 = mean(`Overall Homeless, 2020`),
            avg_unhoused_2019 = mean(`Overall Homeless, 2019`),
            avg_unhoused_2018 = mean(`Overall Homeless, 2018`),
            avg_unhoused_2017 = mean(`Overall Homeless, 2017`),
            avg_unhoused_2016 = mean(`Overall Homeless, 2016`),
            avg_unhoused_2015 = mean(`Overall Homeless, 2015`),
            avg_unhoused_2014 = mean(`Overall Homeless, 2014`),
            avg_unhoused_2013 = mean(`Overall Homeless, 2013`),
            avg_unhoused_2012 = mean(`Overall Homeless, 2012`),
            avg_unhoused_2011 = mean(`Overall Homeless, 2011`),
            avg_unhoused_2010 = mean(`Overall Homeless, 2010`),
            avg_unhoused_2009 = mean(`Overall Homeless, 2009`),
            avg_unhoused_2008 = mean(`Overall Homeless, 2008`),
            avg_unhoused_2007 = mean(`Overall Homeless, 2007`)) 
#main_unhoused_city_plot
```



```{r, HIT_background}
#shorter way to upload all HIT dfs for 2007-2022
path <- "~/Downloads/2007-2022-HIC-Counts-by-CoC.xlsx"
#install.packages("openxlsx")
library(openxlsx)
sheets <- openxlsx::getSheetNames(path)
main_shelter_list <- lapply(sheets, openxlsx::read.xlsx, xlsxFile=path)
names(main_shelter_list) <- sheets
```

```{r, HIT_merge}
#dropped unnecessary columns from HIT list
main_shelter_shortened <- lapply(main_shelter_list, function(dataset) dataset[, c(1,2,6,7,8), drop = FALSE])

#merge all df for all years together
main_shelter <- main_shelter_shortened |>
  reduce(inner_join, by = c("CoC.Number"))
main_shelter <- main_shelter |>
  filter(`CoC.Number` != "NA") |>
  rename(`CoC Number` = "CoC.Number")
```

```{r, merge_HIT_PIT}
merged_shelter_unhoused <- merge(main_shelter, main_unhoused, by = "CoC Number", all = FALSE)
```


